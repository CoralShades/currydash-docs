---
title: User Profile
description: User profile management endpoints including profile CRUD, address management, and payment methods
---

import { Callout, Steps, Tabs } from 'nextra/components'

# User Profile

User profile management endpoints for viewing and updating customer information, managing delivery addresses, and payment methods.

<Callout type="info">
  All profile endpoints require authentication via JWT token with `auth:api` guard.
</Callout>

## Overview

The CurryDash user profile system provides:

- **Profile Management**: View and update customer profile information
- **Address Management**: CRUD operations for delivery addresses
- **Payment Methods**: Manage saved payment cards and methods
- **Image Upload**: Profile picture management with validation
- **Account Settings**: Notification preferences and privacy settings

### Profile Features

| Feature | Endpoint | Description |
|---------|----------|-------------|
| Get Profile | `GET /api/v1/customer/info` | Retrieve authenticated user profile |
| Update Profile | `POST /api/v1/customer/update-profile` | Update profile information |
| Update Image | `POST /api/v1/customer/update-profile` | Upload profile picture |
| Delete Account | `DELETE /api/v1/customer/remove-account` | Permanently delete account |

### Address Management

| Feature | Endpoint | Description |
|---------|----------|-------------|
| List Addresses | `GET /api/v1/customer/address/list` | Get all saved addresses |
| Add Address | `POST /api/v1/customer/address/add` | Create new delivery address |
| Update Address | `PUT /api/v1/customer/address/update/{id}` | Update existing address |
| Delete Address | `DELETE /api/v1/customer/address/delete` | Remove saved address |

---

## Profile Endpoints

### Get Profile

Retrieve the authenticated user's complete profile information including wallet balance, loyalty points, and preferences.

#### GET `/api/v1/customer/info`

**Controller**: `App\Http\Controllers\Api\V1\CustomerController@info`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 60 requests/minute

**Request Headers**:

```
Authorization: Bearer {access_token}
```

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');

        $response = Http::withToken($accessToken)
            ->get('https://api.currydash.au/api/v1/customer/info');

        if ($response->successful()) {
            $user = $response->json();

            // Cache profile data
            cache()->put('user_profile_' . $user['id'], $user, now()->addMinutes(5));

            return response()->json([
                'success' => true,
                'user' => $user,
            ]);
        }

        // Handle unauthorized (401)
        if ($response->status() === 401) {
            return response()->json([
                'success' => false,
                'message' => 'Authentication required',
            ], 401);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to retrieve profile',
        ], $response->status());

    } catch (RequestException $e) {
        // Handle network or timeout errors
        Log::error('Get profile request failed', [
            'error' => $e->getMessage(),
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to profile service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> getProfile() async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        if (accessToken == null) {
          return {
            'success': false,
            'message': 'No access token available',
          };
        }

        final response = await http.get(
          Uri.parse('https://api.currydash.au/api/v1/customer/info'),
          headers: {
            'Authorization': 'Bearer $accessToken',
            'Accept': 'application/json',
          },
        );

        if (response.statusCode == 200) {
          final user = jsonDecode(response.body);

          // Cache profile data locally (optional)
          await storage.write(key: 'user_profile', value: jsonEncode(user));

          return {
            'success': true,
            'user': user,
          };
        }

        // Handle unauthorized (401)
        if (response.statusCode == 401) {
          return {
            'success': false,
            'message': 'Authentication required',
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to retrieve profile',
        };

      } catch (e) {
        // Handle network or timeout errors
        debugPrint('Get profile request failed: $e');

        return {
          'success': false,
          'message': 'Unable to connect to profile service',
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    curl -X GET https://api.currydash.au/api/v1/customer/info \
      -H "Authorization: Bearer {access_token}" \
      -H "Accept: application/json"
    ```
  </Tabs.Tab>
</Tabs>

**Success Response** (200 OK):

```json
{
  "id": 123,
  "f_name": "John",
  "l_name": "Doe",
  "email": "john.doe@example.com",
  "phone": "+61412345678",
  "image": "https://currydash.au/storage/profile/user_123.jpg",
  "is_phone_verified": 1,
  "email_verified_at": "2025-11-15T08:30:00.000000Z",
  "wallet_balance": 45.50,
  "loyalty_point": 320,
  "ref_code": "JD123ABC",
  "order_count": 28,
  "member_since_days": 156,
  "created_at": "2025-07-15T10:00:00.000000Z",
  "updated_at": "2025-12-10T14:20:00.000000Z"
}
```

**Response Fields**:

| Field | Type | Description |
|-------|------|-------------|
| `id` | integer | User ID |
| `f_name` | string | First name |
| `l_name` | string | Last name |
| `email` | string | Email address |
| `phone` | string | Phone number with country code |
| `image` | string/null | Profile picture URL |
| `is_phone_verified` | integer | Phone verification status (0/1) |
| `email_verified_at` | string/null | Email verification timestamp |
| `wallet_balance` | decimal | Current wallet balance (AUD) |
| `loyalty_point` | integer | Accumulated loyalty points |
| `ref_code` | string | User's referral code |
| `order_count` | integer | Total completed orders |
| `member_since_days` | integer | Days since registration |

**Error Response** (401 Unauthorized):

```json
{
  "errors": [
    {
      "code": "auth-001",
      "message": "Unauthenticated"
    }
  ]
}
```

<Callout type="info">
  Profile data is cached for 5 minutes to improve performance. Wallet balance and loyalty points are always real-time.
</Callout>

---

### Update Profile

Update user profile information including name, email, phone, and profile image.

#### POST `/api/v1/customer/update-profile`

**Controller**: `App\Http\Controllers\Api\V1\CustomerController@updateProfile`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 10 requests/minute

**Content-Type**: `multipart/form-data` (for image upload) or `application/json`

**Request Body**:

```json
{
  "f_name": "John",
  "l_name": "Doe",
  "email": "john.doe@example.com",
  "phone": "+61412345678",
  "password": "NewSecurePass123",
  "image": "(binary file data)"
}
```

**Field Descriptions**:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `f_name` | string | Yes | First name (max 100 characters) |
| `l_name` | string | Yes | Last name (max 100 characters) |
| `email` | string | Yes | Valid email address |
| `phone` | string | No | Phone with country code |
| `password` | string | No | New password (min 8 characters) |
| `image` | file | No | Profile picture (JPG, PNG, max 2MB) |

**Validation Rules**:

```php
[
    'f_name' => 'required|string|max:100',
    'l_name' => 'required|string|max:100',
    'email' => 'required|email|unique:users,email,' . $user_id . '|max:100',
    'phone' => 'nullable|unique:users,phone,' . $user_id . '|regex:/^\+[0-9]{10,15}$/',
    'password' => 'nullable|min:8',
    'image' => 'nullable|image|mimes:jpg,jpeg,png|max:2048',
]
```

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');

        // For JSON update (no image)
        $response = Http::withToken($accessToken)
            ->post('https://api.currydash.au/api/v1/customer/update-profile', [
                'f_name' => 'John',
                'l_name' => 'Doe',
                'email' => 'john.doe@example.com',
                'phone' => '+61412345678',
                'password' => 'NewSecurePass123',
            ]);

        // For multipart form data (with image)
        $response = Http::withToken($accessToken)
            ->attach('image', file_get_contents($imagePath), 'profile.jpg')
            ->post('https://api.currydash.au/api/v1/customer/update-profile', [
                'f_name' => 'John',
                'l_name' => 'Doe',
                'email' => 'john.doe@example.com',
            ]);

        if ($response->successful()) {
            $data = $response->json();

            // Update cached profile
            cache()->forget('user_profile_' . $data['user']['id']);

            return response()->json([
                'success' => true,
                'message' => $data['message'],
                'user' => $data['user'],
            ]);
        }

        // Handle validation errors (422)
        if ($response->status() === 422) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'errors' => $errors,
            ], 422);
        }

        // Handle file too large (413)
        if ($response->status() === 413) {
            return response()->json([
                'success' => false,
                'message' => 'Image file is too large (max 2MB)',
            ], 413);
        }

        // Handle unauthorized (401)
        if ($response->status() === 401) {
            return response()->json([
                'success' => false,
                'message' => 'Authentication required',
            ], 401);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to update profile',
        ], $response->status());

    } catch (RequestException $e) {
        // Handle network or timeout errors
        Log::error('Update profile request failed', [
            'error' => $e->getMessage(),
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to profile service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'dart:io';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> updateProfile({
      required String firstName,
      required String lastName,
      required String email,
      String? phone,
      String? password,
      File? imageFile,
    }) async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        if (accessToken == null) {
          return {
            'success': false,
            'message': 'No access token available',
          };
        }

        final uri = Uri.parse('https://api.currydash.au/api/v1/customer/update-profile');
        http.Response response;

        if (imageFile != null) {
          // Multipart request for image upload
          final request = http.MultipartRequest('POST', uri)
            ..headers['Authorization'] = 'Bearer $accessToken'
            ..headers['Accept'] = 'application/json'
            ..fields['f_name'] = firstName
            ..fields['l_name'] = lastName
            ..fields['email'] = email;

          if (phone != null) request.fields['phone'] = phone;
          if (password != null) request.fields['password'] = password;

          request.files.add(await http.MultipartFile.fromPath(
            'image',
            imageFile.path,
          ));

          final streamedResponse = await request.send();
          response = await http.Response.fromStream(streamedResponse);
        } else {
          // JSON request (no image)
          response = await http.post(
            uri,
            headers: {
              'Authorization': 'Bearer $accessToken',
              'Content-Type': 'application/json',
              'Accept': 'application/json',
            },
            body: jsonEncode({
              'f_name': firstName,
              'l_name': lastName,
              'email': email,
              if (phone != null) 'phone': phone,
              if (password != null) 'password': password,
            }),
          );
        }

        if (response.statusCode == 200) {
          final data = jsonDecode(response.body);

          // Update cached profile
          await storage.delete(key: 'user_profile');
          await storage.write(key: 'user', value: jsonEncode(data['user']));

          return {
            'success': true,
            'message': data['message'],
            'user': data['user'],
          };
        }

        // Handle validation errors (422)
        if (response.statusCode == 422) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'errors': errors,
          };
        }

        // Handle file too large (413)
        if (response.statusCode == 413) {
          return {
            'success': false,
            'message': 'Image file is too large (max 2MB)',
          };
        }

        // Handle unauthorized (401)
        if (response.statusCode == 401) {
          return {
            'success': false,
            'message': 'Authentication required',
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to update profile',
        };

      } catch (e) {
        // Handle network or timeout errors
        debugPrint('Update profile request failed: $e');

        return {
          'success': false,
          'message': 'Unable to connect to profile service',
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    # JSON update (no image)
    curl -X POST https://api.currydash.au/api/v1/customer/update-profile \
      -H "Authorization: Bearer {access_token}" \
      -H "Content-Type: application/json" \
      -H "Accept: application/json" \
      -d '{
        "f_name": "John",
        "l_name": "Doe",
        "email": "john.doe@example.com",
        "phone": "+61412345678"
      }'

    # Multipart form data (with image)
    curl -X POST https://api.currydash.au/api/v1/customer/update-profile \
      -H "Authorization: Bearer {access_token}" \
      -F "f_name=John" \
      -F "l_name=Doe" \
      -F "email=john.doe@example.com" \
      -F "image=@/path/to/profile.jpg"
    ```
  </Tabs.Tab>
</Tabs>

**Success Response** (200 OK):

```json
{
  "message": "Profile updated successfully",
  "user": {
    "id": 123,
    "f_name": "John",
    "l_name": "Doe",
    "email": "john.doe@example.com",
    "phone": "+61412345678",
    "image": "https://currydash.au/storage/profile/user_123.jpg",
    "updated_at": "2025-12-10T15:45:00.000000Z"
  }
}
```

**Error Response** (422 Unprocessable Entity):

```json
{
  "errors": [
    {
      "code": "validation-001",
      "message": "The email has already been taken.",
      "field": "email"
    }
  ]
}
```

**Error Response** (413 Payload Too Large):

```json
{
  "errors": [
    {
      "code": "file-001",
      "message": "The image may not be greater than 2048 kilobytes."
    }
  ]
}
```

<Callout type="warning">
  Changing email or phone requires re-verification. Users will receive verification codes via the new contact method.
</Callout>

---

## Address Management

### List Addresses

Retrieve all saved delivery addresses for the authenticated user.

#### GET `/api/v1/customer/address/list`

**Controller**: `App\Http\Controllers\Api\V1\CustomerController@addressList`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 60 requests/minute

**Query Parameters**:

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `limit` | integer | No | Results per page (default: 10, max: 50) |
| `offset` | integer | No | Pagination offset (default: 0) |

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');

        $response = Http::withToken($accessToken)
            ->get('https://api.currydash.au/api/v1/customer/address/list', [
                'limit' => 10,
                'offset' => 0,
            ]);

        if ($response->successful()) {
            $data = $response->json();

            return response()->json([
                'success' => true,
                'total' => $data['total'],
                'addresses' => $data['addresses'],
            ]);
        }

        // Handle unauthorized (401)
        if ($response->status() === 401) {
            return response()->json([
                'success' => false,
                'message' => 'Authentication required',
            ], 401);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to retrieve addresses',
        ], $response->status());

    } catch (RequestException $e) {
        // Handle network or timeout errors
        Log::error('List addresses request failed', [
            'error' => $e->getMessage(),
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to address service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> listAddresses({
      int limit = 10,
      int offset = 0,
    }) async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        if (accessToken == null) {
          return {
            'success': false,
            'message': 'No access token available',
          };
        }

        final response = await http.get(
          Uri.parse('https://api.currydash.au/api/v1/customer/address/list?limit=$limit&offset=$offset'),
          headers: {
            'Authorization': 'Bearer $accessToken',
            'Accept': 'application/json',
          },
        );

        if (response.statusCode == 200) {
          final data = jsonDecode(response.body);

          return {
            'success': true,
            'total': data['total'],
            'addresses': data['addresses'],
          };
        }

        // Handle unauthorized (401)
        if (response.statusCode == 401) {
          return {
            'success': false,
            'message': 'Authentication required',
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to retrieve addresses',
        };

      } catch (e) {
        // Handle network or timeout errors
        debugPrint('List addresses request failed: $e');

        return {
          'success': false,
          'message': 'Unable to connect to address service',
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    curl -X GET "https://api.currydash.au/api/v1/customer/address/list?limit=10&offset=0" \
      -H "Authorization: Bearer {access_token}" \
      -H "Accept: application/json"
    ```
  </Tabs.Tab>
</Tabs>

**Success Response** (200 OK):

```json
{
  "total": 3,
  "limit": 10,
  "offset": 0,
  "addresses": [
    {
      "id": 45,
      "address_type": "home",
      "contact_person_name": "John Doe",
      "contact_person_number": "+61412345678",
      "address": "123 Main Street",
      "floor": "2nd Floor",
      "road": "George Street",
      "house": "Apartment 5B",
      "latitude": "-33.8688",
      "longitude": "151.2093",
      "zone_id": 1,
      "is_default": 1,
      "created_at": "2025-10-15T09:00:00.000000Z",
      "updated_at": "2025-12-01T11:30:00.000000Z"
    },
    {
      "id": 46,
      "address_type": "office",
      "contact_person_name": "John Doe",
      "contact_person_number": "+61412345678",
      "address": "456 Business Ave",
      "floor": "10th Floor",
      "road": "Kent Street",
      "house": "Suite 1001",
      "latitude": "-33.8650",
      "longitude": "151.2070",
      "zone_id": 1,
      "is_default": 0,
      "created_at": "2025-11-20T14:15:00.000000Z",
      "updated_at": "2025-11-20T14:15:00.000000Z"
    }
  ]
}
```

**Address Types**:

- `home` - Residential address
- `office` - Workplace address
- `other` - Custom location

---

### Add Address

Create a new delivery address for the authenticated user.

#### POST `/api/v1/customer/address/add`

**Controller**: `App\Http\Controllers\Api\V1\CustomerController@addAddress`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 20 requests/minute

**Request Body**:

```json
{
  "address_type": "home",
  "contact_person_name": "John Doe",
  "contact_person_number": "+61412345678",
  "address": "123 Main Street",
  "floor": "2nd Floor",
  "road": "George Street",
  "house": "Apartment 5B",
  "latitude": "-33.8688",
  "longitude": "151.2093",
  "zone_id": 1,
  "is_default": 1
}
```

**Field Descriptions**:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `address_type` | string | Yes | Address type: `home`, `office`, `other` |
| `contact_person_name` | string | Yes | Recipient name (max 100 characters) |
| `contact_person_number` | string | Yes | Contact phone with country code |
| `address` | string | Yes | Full street address (max 250 characters) |
| `floor` | string | No | Floor/level information |
| `road` | string | No | Road/street name |
| `house` | string | No | Building/apartment number |
| `latitude` | string | Yes | GPS latitude coordinate |
| `longitude` | string | Yes | GPS longitude coordinate |
| `zone_id` | integer | Yes | Delivery zone ID (must exist) |
| `is_default` | integer | No | Set as default address (0/1) |

**Validation Rules**:

```php
[
    'address_type' => 'required|in:home,office,other',
    'contact_person_name' => 'required|string|max:100',
    'contact_person_number' => 'required|regex:/^\+[0-9]{10,15}$/',
    'address' => 'required|string|max:250',
    'floor' => 'nullable|string|max:50',
    'road' => 'nullable|string|max:100',
    'house' => 'nullable|string|max:50',
    'latitude' => 'required|numeric|between:-90,90',
    'longitude' => 'required|numeric|between:-180,180',
    'zone_id' => 'required|exists:zones,id',
    'is_default' => 'nullable|boolean',
]
```

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');

        $response = Http::withToken($accessToken)
            ->post('https://api.currydash.au/api/v1/customer/address/add', [
                'address_type' => 'home',
                'contact_person_name' => 'John Doe',
                'contact_person_number' => '+61412345678',
                'address' => '123 Main Street',
                'floor' => '2nd Floor',
                'road' => 'George Street',
                'house' => 'Apartment 5B',
                'latitude' => '-33.8688',
                'longitude' => '151.2093',
                'zone_id' => 1,
                'is_default' => 1,
            ]);

        if ($response->successful()) {
            $data = $response->json();

            return response()->json([
                'success' => true,
                'message' => $data['message'],
                'address_id' => $data['address_id'],
                'address' => $data['address'],
            ], 201);
        }

        // Handle validation errors (422)
        if ($response->status() === 422) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'errors' => $errors,
            ], 422);
        }

        // Handle coverage area error (400)
        if ($response->status() === 400) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => 'Address is outside delivery coverage area',
                'errors' => $errors,
            ], 400);
        }

        // Handle unauthorized (401)
        if ($response->status() === 401) {
            return response()->json([
                'success' => false,
                'message' => 'Authentication required',
            ], 401);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to add address',
        ], $response->status());

    } catch (RequestException $e) {
        // Handle network or timeout errors
        Log::error('Add address request failed', [
            'error' => $e->getMessage(),
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to address service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> addAddress({
      required String addressType,
      required String contactPersonName,
      required String contactPersonNumber,
      required String address,
      required String latitude,
      required String longitude,
      required int zoneId,
      String? floor,
      String? road,
      String? house,
      int isDefault = 0,
    }) async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        if (accessToken == null) {
          return {
            'success': false,
            'message': 'No access token available',
          };
        }

        final response = await http.post(
          Uri.parse('https://api.currydash.au/api/v1/customer/address/add'),
          headers: {
            'Authorization': 'Bearer $accessToken',
            'Content-Type': 'application/json',
            'Accept': 'application/json',
          },
          body: jsonEncode({
            'address_type': addressType,
            'contact_person_name': contactPersonName,
            'contact_person_number': contactPersonNumber,
            'address': address,
            if (floor != null) 'floor': floor,
            if (road != null) 'road': road,
            if (house != null) 'house': house,
            'latitude': latitude,
            'longitude': longitude,
            'zone_id': zoneId,
            'is_default': isDefault,
          }),
        );

        if (response.statusCode == 201) {
          final data = jsonDecode(response.body);

          return {
            'success': true,
            'message': data['message'],
            'address_id': data['address_id'],
            'address': data['address'],
          };
        }

        // Handle validation errors (422)
        if (response.statusCode == 422) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'errors': errors,
          };
        }

        // Handle coverage area error (400)
        if (response.statusCode == 400) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': 'Address is outside delivery coverage area',
            'errors': errors,
          };
        }

        // Handle unauthorized (401)
        if (response.statusCode == 401) {
          return {
            'success': false,
            'message': 'Authentication required',
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to add address',
        };

      } catch (e) {
        // Handle network or timeout errors
        debugPrint('Add address request failed: $e');

        return {
          'success': false,
          'message': 'Unable to connect to address service',
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    curl -X POST https://api.currydash.au/api/v1/customer/address/add \
      -H "Authorization: Bearer {access_token}" \
      -H "Content-Type: application/json" \
      -H "Accept: application/json" \
      -d '{
        "address_type": "home",
        "contact_person_name": "John Doe",
        "contact_person_number": "+61412345678",
        "address": "123 Main Street",
        "floor": "2nd Floor",
        "road": "George Street",
        "house": "Apartment 5B",
        "latitude": "-33.8688",
        "longitude": "151.2093",
        "zone_id": 1,
        "is_default": 1
      }'
    ```
  </Tabs.Tab>
</Tabs>

**Success Response** (201 Created):

```json
{
  "message": "Address added successfully",
  "address_id": 47,
  "address": {
    "id": 47,
    "address_type": "home",
    "contact_person_name": "John Doe",
    "contact_person_number": "+61412345678",
    "address": "123 Main Street",
    "floor": "2nd Floor",
    "road": "George Street",
    "house": "Apartment 5B",
    "latitude": "-33.8688",
    "longitude": "151.2093",
    "zone_id": 1,
    "is_default": 1,
    "created_at": "2025-12-10T16:00:00.000000Z",
    "updated_at": "2025-12-10T16:00:00.000000Z"
  }
}
```

**Error Response** (422 Unprocessable Entity):

```json
{
  "errors": [
    {
      "code": "validation-001",
      "message": "The selected zone id is invalid.",
      "field": "zone_id"
    }
  ]
}
```

**Error Response** (400 Bad Request):

```json
{
  "errors": [
    {
      "code": "address-001",
      "message": "Address is outside delivery coverage area"
    }
  ]
}
```

<Callout type="info">
  Setting `is_default` to 1 will automatically unset other default addresses. The system validates that coordinates fall within the selected zone's coverage area.
</Callout>

---

### Update Address

Modify an existing delivery address.

#### PUT `/api/v1/customer/address/update/{id}`

**Controller**: `App\Http\Controllers\Api\V1\CustomerController@updateAddress`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 20 requests/minute

**Path Parameters**:

| Parameter | Type | Description |
|-----------|------|-------------|
| `id` | integer | Address ID to update |

**Request Body**:

```json
{
  "address_type": "office",
  "contact_person_name": "John Doe",
  "contact_person_number": "+61412345678",
  "address": "456 Business Ave",
  "floor": "10th Floor",
  "road": "Kent Street",
  "house": "Suite 1001",
  "latitude": "-33.8650",
  "longitude": "151.2070",
  "zone_id": 1,
  "is_default": 0
}
```

**Validation Rules**: Same as Add Address endpoint

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');
        $addressId = 45;

        $response = Http::withToken($accessToken)
            ->put("https://api.currydash.au/api/v1/customer/address/update/{$addressId}", [
                'address_type' => 'office',
                'contact_person_name' => 'John Doe',
                'contact_person_number' => '+61412345678',
                'address' => '456 Business Ave',
                'floor' => '10th Floor',
                'road' => 'Kent Street',
                'house' => 'Suite 1001',
                'latitude' => '-33.8650',
                'longitude' => '151.2070',
                'zone_id' => 1,
                'is_default' => 0,
            ]);

        if ($response->successful()) {
            $data = $response->json();

            return response()->json([
                'success' => true,
                'message' => $data['message'],
                'address' => $data['address'],
            ]);
        }

        // Handle validation errors (422)
        if ($response->status() === 422) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'errors' => $errors,
            ], 422);
        }

        // Handle not found (404)
        if ($response->status() === 404) {
            return response()->json([
                'success' => false,
                'message' => 'Address not found',
            ], 404);
        }

        // Handle forbidden (403)
        if ($response->status() === 403) {
            return response()->json([
                'success' => false,
                'message' => 'You do not have permission to update this address',
            ], 403);
        }

        // Handle unauthorized (401)
        if ($response->status() === 401) {
            return response()->json([
                'success' => false,
                'message' => 'Authentication required',
            ], 401);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to update address',
        ], $response->status());

    } catch (RequestException $e) {
        // Handle network or timeout errors
        Log::error('Update address request failed', [
            'error' => $e->getMessage(),
            'address_id' => $addressId,
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to address service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> updateAddress({
      required int addressId,
      required String addressType,
      required String contactPersonName,
      required String contactPersonNumber,
      required String address,
      required String latitude,
      required String longitude,
      required int zoneId,
      String? floor,
      String? road,
      String? house,
      int isDefault = 0,
    }) async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        if (accessToken == null) {
          return {
            'success': false,
            'message': 'No access token available',
          };
        }

        final response = await http.put(
          Uri.parse('https://api.currydash.au/api/v1/customer/address/update/$addressId'),
          headers: {
            'Authorization': 'Bearer $accessToken',
            'Content-Type': 'application/json',
            'Accept': 'application/json',
          },
          body: jsonEncode({
            'address_type': addressType,
            'contact_person_name': contactPersonName,
            'contact_person_number': contactPersonNumber,
            'address': address,
            if (floor != null) 'floor': floor,
            if (road != null) 'road': road,
            if (house != null) 'house': house,
            'latitude': latitude,
            'longitude': longitude,
            'zone_id': zoneId,
            'is_default': isDefault,
          }),
        );

        if (response.statusCode == 200) {
          final data = jsonDecode(response.body);

          return {
            'success': true,
            'message': data['message'],
            'address': data['address'],
          };
        }

        // Handle validation errors (422)
        if (response.statusCode == 422) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'errors': errors,
          };
        }

        // Handle not found (404)
        if (response.statusCode == 404) {
          return {
            'success': false,
            'message': 'Address not found',
          };
        }

        // Handle forbidden (403)
        if (response.statusCode == 403) {
          return {
            'success': false,
            'message': 'You do not have permission to update this address',
          };
        }

        // Handle unauthorized (401)
        if (response.statusCode == 401) {
          return {
            'success': false,
            'message': 'Authentication required',
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to update address',
        };

      } catch (e) {
        // Handle network or timeout errors
        debugPrint('Update address request failed: $e');

        return {
          'success': false,
          'message': 'Unable to connect to address service',
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    curl -X PUT https://api.currydash.au/api/v1/customer/address/update/45 \
      -H "Authorization: Bearer {access_token}" \
      -H "Content-Type: application/json" \
      -H "Accept: application/json" \
      -d '{
        "address_type": "office",
        "contact_person_name": "John Doe",
        "contact_person_number": "+61412345678",
        "address": "456 Business Ave",
        "floor": "10th Floor",
        "road": "Kent Street",
        "house": "Suite 1001",
        "latitude": "-33.8650",
        "longitude": "151.2070",
        "zone_id": 1,
        "is_default": 0
      }'
    ```
  </Tabs.Tab>
</Tabs>

**Success Response** (200 OK):

```json
{
  "message": "Address updated successfully",
  "address": {
    "id": 45,
    "address_type": "office",
    "contact_person_name": "John Doe",
    "contact_person_number": "+61412345678",
    "address": "456 Business Ave",
    "floor": "10th Floor",
    "road": "Kent Street",
    "house": "Suite 1001",
    "latitude": "-33.8650",
    "longitude": "151.2070",
    "zone_id": 1,
    "is_default": 0,
    "updated_at": "2025-12-10T16:30:00.000000Z"
  }
}
```

**Error Response** (404 Not Found):

```json
{
  "errors": [
    {
      "code": "address-002",
      "message": "Address not found"
    }
  ]
}
```

**Error Response** (403 Forbidden):

```json
{
  "errors": [
    {
      "code": "address-003",
      "message": "You do not have permission to update this address"
    }
  ]
}
```

---

### Delete Address

Remove a saved delivery address.

#### DELETE `/api/v1/customer/address/delete`

**Controller**: `App\Http\Controllers\Api\V1\CustomerController@deleteAddress`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 20 requests/minute

**Query Parameters**:

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `address_id` | integer | Yes | Address ID to delete |

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');
        $addressId = 45;

        $response = Http::withToken($accessToken)
            ->delete('https://api.currydash.au/api/v1/customer/address/delete', [
                'address_id' => $addressId,
            ]);

        if ($response->successful()) {
            $data = $response->json();

            return response()->json([
                'success' => true,
                'message' => $data['message'],
            ]);
        }

        // Handle not found (404)
        if ($response->status() === 404) {
            return response()->json([
                'success' => false,
                'message' => 'Address not found',
            ], 404);
        }

        // Handle pending orders error (400)
        if ($response->status() === 400) {
            return response()->json([
                'success' => false,
                'message' => 'Cannot delete address with pending orders',
            ], 400);
        }

        // Handle unauthorized (401)
        if ($response->status() === 401) {
            return response()->json([
                'success' => false,
                'message' => 'Authentication required',
            ], 401);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to delete address',
        ], $response->status());

    } catch (RequestException $e) {
        // Handle network or timeout errors
        Log::error('Delete address request failed', [
            'error' => $e->getMessage(),
            'address_id' => $addressId,
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to address service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> deleteAddress({
      required int addressId,
    }) async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        if (accessToken == null) {
          return {
            'success': false,
            'message': 'No access token available',
          };
        }

        final response = await http.delete(
          Uri.parse('https://api.currydash.au/api/v1/customer/address/delete?address_id=$addressId'),
          headers: {
            'Authorization': 'Bearer $accessToken',
            'Accept': 'application/json',
          },
        );

        if (response.statusCode == 200) {
          final data = jsonDecode(response.body);

          return {
            'success': true,
            'message': data['message'],
          };
        }

        // Handle not found (404)
        if (response.statusCode == 404) {
          return {
            'success': false,
            'message': 'Address not found',
          };
        }

        // Handle pending orders error (400)
        if (response.statusCode == 400) {
          return {
            'success': false,
            'message': 'Cannot delete address with pending orders',
          };
        }

        // Handle unauthorized (401)
        if (response.statusCode == 401) {
          return {
            'success': false,
            'message': 'Authentication required',
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to delete address',
        };

      } catch (e) {
        // Handle network or timeout errors
        debugPrint('Delete address request failed: $e');

        return {
          'success': false,
          'message': 'Unable to connect to address service',
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    curl -X DELETE "https://api.currydash.au/api/v1/customer/address/delete?address_id=45" \
      -H "Authorization: Bearer {access_token}" \
      -H "Accept: application/json"
    ```
  </Tabs.Tab>
</Tabs>

**Success Response** (200 OK):

```json
{
  "message": "Address deleted successfully"
}
```

**Error Response** (404 Not Found):

```json
{
  "errors": [
    {
      "code": "address-002",
      "message": "Address not found"
    }
  ]
}
```

**Error Response** (400 Bad Request):

```json
{
  "errors": [
    {
      "code": "address-004",
      "message": "Cannot delete address with pending orders"
    }
  ]
}
```

<Callout type="warning">
  Addresses associated with pending or in-progress orders cannot be deleted. Wait for order completion or cancellation before removing the address.
</Callout>

---

## Payment Methods

### List Payment Methods

Retrieve all saved payment methods for the authenticated user.

#### GET `/api/v1/customer/payment-methods`

**Controller**: `App\Http\Controllers\Api\V1\CustomerController@getPaymentMethods`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 60 requests/minute

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');

        $response = Http::withToken($accessToken)
            ->get('https://api.currydash.au/api/v1/customer/payment-methods');

        if ($response->successful()) {
            $data = $response->json();

            return response()->json([
                'success' => true,
                'payment_methods' => $data['payment_methods'],
            ]);
        }

        // Handle unauthorized (401)
        if ($response->status() === 401) {
            return response()->json([
                'success' => false,
                'message' => 'Authentication required',
            ], 401);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to retrieve payment methods',
        ], $response->status());

    } catch (RequestException $e) {
        // Handle network or timeout errors
        Log::error('List payment methods request failed', [
            'error' => $e->getMessage(),
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to payment service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> listPaymentMethods() async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        if (accessToken == null) {
          return {
            'success': false,
            'message': 'No access token available',
          };
        }

        final response = await http.get(
          Uri.parse('https://api.currydash.au/api/v1/customer/payment-methods'),
          headers: {
            'Authorization': 'Bearer $accessToken',
            'Accept': 'application/json',
          },
        );

        if (response.statusCode == 200) {
          final data = jsonDecode(response.body);

          return {
            'success': true,
            'payment_methods': data['payment_methods'],
          };
        }

        // Handle unauthorized (401)
        if (response.statusCode == 401) {
          return {
            'success': false,
            'message': 'Authentication required',
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to retrieve payment methods',
        };

      } catch (e) {
        // Handle network or timeout errors
        debugPrint('List payment methods request failed: $e');

        return {
          'success': false,
          'message': 'Unable to connect to payment service',
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    curl -X GET https://api.currydash.au/api/v1/customer/payment-methods \
      -H "Authorization: Bearer {access_token}" \
      -H "Accept: application/json"
    ```
  </Tabs.Tab>
</Tabs>

**Success Response** (200 OK):

```json
{
  "payment_methods": [
    {
      "id": 12,
      "type": "card",
      "provider": "stripe",
      "last_four": "4242",
      "brand": "visa",
      "exp_month": 12,
      "exp_year": 2026,
      "is_default": 1,
      "created_at": "2025-09-10T10:00:00.000000Z"
    },
    {
      "id": 13,
      "type": "card",
      "provider": "stripe",
      "last_four": "5555",
      "brand": "mastercard",
      "exp_month": 8,
      "exp_year": 2025,
      "is_default": 0,
      "created_at": "2025-11-05T14:20:00.000000Z"
    }
  ]
}
```

**Payment Method Types**:

- `card` - Credit/debit card
- `wallet` - Digital wallet (PayPal, Apple Pay, Google Pay)
- `bank_transfer` - Direct bank transfer

**Supported Card Brands**:

- `visa`
- `mastercard`
- `amex`
- `discover`

---

### Add Payment Method

Add a new payment method (credit card) to the user's account.

#### POST `/api/v1/customer/payment-methods/add`

**Controller**: `App\Http\Controllers\Api\V1\CustomerController@addPaymentMethod`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 10 requests/minute

**Request Body**:

```json
{
  "payment_method_id": "pm_1AbCdEfGhIjKlMnO",
  "is_default": 1
}
```

**Field Descriptions**:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `payment_method_id` | string | Yes | Stripe payment method ID from client-side tokenization |
| `is_default` | integer | No | Set as default payment method (0/1) |

**Validation Rules**:

```php
[
    'payment_method_id' => 'required|string',
    'is_default' => 'nullable|boolean',
]
```

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');

        // Payment method ID from client-side Stripe tokenization
        $paymentMethodId = 'pm_1AbCdEfGhIjKlMnO';

        $response = Http::withToken($accessToken)
            ->post('https://api.currydash.au/api/v1/customer/payment-methods/add', [
                'payment_method_id' => $paymentMethodId,
                'is_default' => 1,
            ]);

        if ($response->successful()) {
            $data = $response->json();

            return response()->json([
                'success' => true,
                'message' => $data['message'],
                'payment_method' => $data['payment_method'],
            ], 201);
        }

        // Handle validation errors (422)
        if ($response->status() === 422) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => 'Card has expired or is invalid',
                'errors' => $errors,
            ], 422);
        }

        // Handle invalid payment method (400)
        if ($response->status() === 400) {
            return response()->json([
                'success' => false,
                'message' => 'Invalid payment method ID',
            ], 400);
        }

        // Handle unauthorized (401)
        if ($response->status() === 401) {
            return response()->json([
                'success' => false,
                'message' => 'Authentication required',
            ], 401);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to add payment method',
        ], $response->status());

    } catch (RequestException $e) {
        // Handle network or timeout errors
        Log::error('Add payment method request failed', [
            'error' => $e->getMessage(),
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to payment service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> addPaymentMethod({
      required String paymentMethodId,
      int isDefault = 0,
    }) async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        if (accessToken == null) {
          return {
            'success': false,
            'message': 'No access token available',
          };
        }

        // Payment method ID from client-side Stripe tokenization
        final response = await http.post(
          Uri.parse('https://api.currydash.au/api/v1/customer/payment-methods/add'),
          headers: {
            'Authorization': 'Bearer $accessToken',
            'Content-Type': 'application/json',
            'Accept': 'application/json',
          },
          body: jsonEncode({
            'payment_method_id': paymentMethodId,
            'is_default': isDefault,
          }),
        );

        if (response.statusCode == 201) {
          final data = jsonDecode(response.body);

          return {
            'success': true,
            'message': data['message'],
            'payment_method': data['payment_method'],
          };
        }

        // Handle validation errors (422)
        if (response.statusCode == 422) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': 'Card has expired or is invalid',
            'errors': errors,
          };
        }

        // Handle invalid payment method (400)
        if (response.statusCode == 400) {
          return {
            'success': false,
            'message': 'Invalid payment method ID',
          };
        }

        // Handle unauthorized (401)
        if (response.statusCode == 401) {
          return {
            'success': false,
            'message': 'Authentication required',
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to add payment method',
        };

      } catch (e) {
        // Handle network or timeout errors
        debugPrint('Add payment method request failed: $e');

        return {
          'success': false,
          'message': 'Unable to connect to payment service',
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    curl -X POST https://api.currydash.au/api/v1/customer/payment-methods/add \
      -H "Authorization: Bearer {access_token}" \
      -H "Content-Type: application/json" \
      -H "Accept: application/json" \
      -d '{
        "payment_method_id": "pm_1AbCdEfGhIjKlMnO",
        "is_default": 1
      }'
    ```
  </Tabs.Tab>
</Tabs>

**Success Response** (201 Created):

```json
{
  "message": "Payment method added successfully",
  "payment_method": {
    "id": 14,
    "type": "card",
    "provider": "stripe",
    "last_four": "4242",
    "brand": "visa",
    "exp_month": 12,
    "exp_year": 2026,
    "is_default": 1,
    "created_at": "2025-12-10T17:00:00.000000Z"
  }
}
```

**Error Response** (400 Bad Request):

```json
{
  "errors": [
    {
      "code": "payment-001",
      "message": "Invalid payment method ID"
    }
  ]
}
```

**Error Response** (422 Unprocessable Entity):

```json
{
  "errors": [
    {
      "code": "payment-002",
      "message": "Card has expired"
    }
  ]
}
```

<Callout type="info">
  Payment method tokenization must be performed client-side using Stripe.js or similar. Never send raw card details to the backend.
</Callout>

---

### Update Payment Method

Update payment method settings (e.g., set as default).

#### PUT `/api/v1/customer/payment-methods/update/{id}`

**Controller**: `App\Http\Controllers\Api\V1\CustomerController@updatePaymentMethod`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 10 requests/minute

**Path Parameters**:

| Parameter | Type | Description |
|-----------|------|-------------|
| `id` | integer | Payment method ID |

**Request Body**:

```json
{
  "is_default": 1
}
```

**Validation Rules**:

```php
[
    'is_default' => 'required|boolean',
]
```

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');
        $paymentMethodId = 13;

        $response = Http::withToken($accessToken)
            ->put("https://api.currydash.au/api/v1/customer/payment-methods/update/{$paymentMethodId}", [
                'is_default' => 1,
            ]);

        if ($response->successful()) {
            $data = $response->json();

            return response()->json([
                'success' => true,
                'message' => $data['message'],
                'payment_method' => $data['payment_method'],
            ]);
        }

        // Handle not found (404)
        if ($response->status() === 404) {
            return response()->json([
                'success' => false,
                'message' => 'Payment method not found',
            ], 404);
        }

        // Handle unauthorized (401)
        if ($response->status() === 401) {
            return response()->json([
                'success' => false,
                'message' => 'Authentication required',
            ], 401);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to update payment method',
        ], $response->status());

    } catch (RequestException $e) {
        // Handle network or timeout errors
        Log::error('Update payment method request failed', [
            'error' => $e->getMessage(),
            'payment_method_id' => $paymentMethodId,
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to payment service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> updatePaymentMethod({
      required int paymentMethodId,
      required int isDefault,
    }) async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        if (accessToken == null) {
          return {
            'success': false,
            'message': 'No access token available',
          };
        }

        final response = await http.put(
          Uri.parse('https://api.currydash.au/api/v1/customer/payment-methods/update/$paymentMethodId'),
          headers: {
            'Authorization': 'Bearer $accessToken',
            'Content-Type': 'application/json',
            'Accept': 'application/json',
          },
          body: jsonEncode({
            'is_default': isDefault,
          }),
        );

        if (response.statusCode == 200) {
          final data = jsonDecode(response.body);

          return {
            'success': true,
            'message': data['message'],
            'payment_method': data['payment_method'],
          };
        }

        // Handle not found (404)
        if (response.statusCode == 404) {
          return {
            'success': false,
            'message': 'Payment method not found',
          };
        }

        // Handle unauthorized (401)
        if (response.statusCode == 401) {
          return {
            'success': false,
            'message': 'Authentication required',
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to update payment method',
        };

      } catch (e) {
        // Handle network or timeout errors
        debugPrint('Update payment method request failed: $e');

        return {
          'success': false,
          'message': 'Unable to connect to payment service',
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    curl -X PUT https://api.currydash.au/api/v1/customer/payment-methods/update/13 \
      -H "Authorization: Bearer {access_token}" \
      -H "Content-Type: application/json" \
      -H "Accept: application/json" \
      -d '{
        "is_default": 1
      }'
    ```
  </Tabs.Tab>
</Tabs>

**Success Response** (200 OK):

```json
{
  "message": "Payment method updated successfully",
  "payment_method": {
    "id": 13,
    "type": "card",
    "provider": "stripe",
    "last_four": "5555",
    "brand": "mastercard",
    "is_default": 1,
    "updated_at": "2025-12-10T17:15:00.000000Z"
  }
}
```

**Error Response** (404 Not Found):

```json
{
  "errors": [
    {
      "code": "payment-003",
      "message": "Payment method not found"
    }
  ]
}
```

---

### Delete Payment Method

Remove a saved payment method.

#### DELETE `/api/v1/customer/payment-methods/delete/{id}`

**Controller**: `App\Http\Controllers\Api\V1\CustomerController@deletePaymentMethod`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 10 requests/minute

**Path Parameters**:

| Parameter | Type | Description |
|-----------|------|-------------|
| `id` | integer | Payment method ID to delete |

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');
        $paymentMethodId = 13;

        $response = Http::withToken($accessToken)
            ->delete("https://api.currydash.au/api/v1/customer/payment-methods/delete/{$paymentMethodId}");

        if ($response->successful()) {
            $data = $response->json();

            return response()->json([
                'success' => true,
                'message' => $data['message'],
            ]);
        }

        // Handle not found (404)
        if ($response->status() === 404) {
            return response()->json([
                'success' => false,
                'message' => 'Payment method not found',
            ], 404);
        }

        // Handle pending transactions error (400)
        if ($response->status() === 400) {
            return response()->json([
                'success' => false,
                'message' => 'Cannot delete payment method with pending transactions',
            ], 400);
        }

        // Handle unauthorized (401)
        if ($response->status() === 401) {
            return response()->json([
                'success' => false,
                'message' => 'Authentication required',
            ], 401);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to delete payment method',
        ], $response->status());

    } catch (RequestException $e) {
        // Handle network or timeout errors
        Log::error('Delete payment method request failed', [
            'error' => $e->getMessage(),
            'payment_method_id' => $paymentMethodId,
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to payment service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> deletePaymentMethod({
      required int paymentMethodId,
    }) async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        if (accessToken == null) {
          return {
            'success': false,
            'message': 'No access token available',
          };
        }

        final response = await http.delete(
          Uri.parse('https://api.currydash.au/api/v1/customer/payment-methods/delete/$paymentMethodId'),
          headers: {
            'Authorization': 'Bearer $accessToken',
            'Accept': 'application/json',
          },
        );

        if (response.statusCode == 200) {
          final data = jsonDecode(response.body);

          return {
            'success': true,
            'message': data['message'],
          };
        }

        // Handle not found (404)
        if (response.statusCode == 404) {
          return {
            'success': false,
            'message': 'Payment method not found',
          };
        }

        // Handle pending transactions error (400)
        if (response.statusCode == 400) {
          return {
            'success': false,
            'message': 'Cannot delete payment method with pending transactions',
          };
        }

        // Handle unauthorized (401)
        if (response.statusCode == 401) {
          return {
            'success': false,
            'message': 'Authentication required',
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to delete payment method',
        };

      } catch (e) {
        // Handle network or timeout errors
        debugPrint('Delete payment method request failed: $e');

        return {
          'success': false,
          'message': 'Unable to connect to payment service',
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    curl -X DELETE https://api.currydash.au/api/v1/customer/payment-methods/delete/13 \
      -H "Authorization: Bearer {access_token}" \
      -H "Accept: application/json"
    ```
  </Tabs.Tab>
</Tabs>

**Success Response** (200 OK):

```json
{
  "message": "Payment method deleted successfully"
}
```

**Error Response** (404 Not Found):

```json
{
  "errors": [
    {
      "code": "payment-003",
      "message": "Payment method not found"
    }
  ]
}
```

**Error Response** (400 Bad Request):

```json
{
  "errors": [
    {
      "code": "payment-004",
      "message": "Cannot delete payment method with pending transactions"
    }
  ]
}
```

<Callout type="warning">
  Payment methods associated with pending or processing orders cannot be deleted. Users must have at least one active payment method if they have recurring subscriptions.
</Callout>

---

## Related Documentation

- **[Authentication](/api/backend/authentication)** - Login and token management
- **[Orders](/api/backend/orders)** - Order placement and history
- **[Zones](/api/backend/zones)** - Delivery zone coverage
- **[Database Documentation](/developers/backend/database)** - User and address models
