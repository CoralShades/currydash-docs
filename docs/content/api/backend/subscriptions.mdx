---
title: Subscriptions
description: Subscription management endpoints for recurring package deliveries including creation, pause, resume, cancel, and update operations
---

import { Callout, Steps, Tabs } from 'nextra/components'

# Subscriptions

Comprehensive subscription management endpoints for creating and managing recurring package deliveries with flexible scheduling, pause/resume functionality, and subscription modifications.

<Callout type="info">
  All subscription endpoints require authentication via JWT token (`auth:api` guard). Subscriptions are only available for packages, not individual food items.
</Callout>

## Overview

The CurryDash subscription system enables customers to:

- **Create Recurring Deliveries**: Set up automated package deliveries on a regular schedule
- **Flexible Scheduling**: Choose weekly, biweekly, or monthly delivery frequencies
- **Pause/Resume**: Temporarily pause subscriptions for vacations or schedule changes
- **Update Subscriptions**: Modify delivery preferences, package selections, or delivery times
- **Cancel Subscriptions**: End recurring deliveries at any time
- **Automated Payments**: Secure recurring payment processing via Stripe or PayPal

### Subscription Status Flow

| Status | Description | Available Actions |
|--------|-------------|-------------------|
| `active` | Subscription is running, deliveries scheduled | Pause, Update, Cancel |
| `paused` | Temporarily paused by customer | Resume, Update, Cancel |
| `canceled` | Subscription terminated | None (create new subscription) |
| `expired` | Payment method failed or expired | Update payment method to reactivate |

### Supported Frequencies

| Frequency | Delivery Schedule |
|-----------|-------------------|
| `weekly` | Every 7 days on selected day |
| `biweekly` | Every 14 days on selected day |
| `monthly` | Every 30 days on selected day |

---

## Endpoints

### Create Subscription

Create a new recurring subscription for a customized package with automated delivery scheduling and payment.

#### POST `/api/v1/subscriptions`

**Controller**: `App\Http\Controllers\Api\V1\SubscriptionController@create`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 10 requests/minute per user

**Request Body**:

```json
{
  "package_id": 1,
  "quantity": 1,
  "selected_options": [
    {"option_id": 1},
    {"option_id": 2},
    {"option_id": 5}
  ],
  "frequency": "weekly",
  "delivery_day": "monday",
  "delivery_time": "18:00",
  "delivery_address_id": 12,
  "start_date": "2025-12-16",
  "payment_method": "stripe"
}
```

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');

        $response = Http::withToken($accessToken)
            ->post('https://api.currydash.au/api/v1/subscriptions', [
                'package_id' => 1,
                'quantity' => 1,
                'selected_options' => [
                    ['option_id' => 1],
                    ['option_id' => 2],
                    ['option_id' => 5],
                ],
                'frequency' => 'weekly',
                'delivery_day' => 'monday',
                'delivery_time' => '18:00',
                'delivery_address_id' => 12,
                'start_date' => '2025-12-16',
                'payment_method' => 'stripe',
            ]);

        if ($response->successful()) {
            $data = $response->json();

            return response()->json([
                'success' => true,
                'message' => 'Subscription created successfully',
                'subscription' => $data,
            ], 201);
        }

        // Handle validation errors (422)
        if ($response->status() === 422) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => 'Validation failed',
                'errors' => $errors,
            ], 422);
        }

        // Handle invalid start date (400)
        if ($response->status() === 400) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => $errors[0]['message'] ?? 'Invalid subscription data',
                'errors' => $errors,
            ], 400);
        }

        // Handle payment setup failure (402)
        if ($response->status() === 402) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => 'Payment authorization failed',
                'errors' => $errors,
            ], 402);
        }

        // Handle zone not available (404)
        if ($response->status() === 404) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => 'Service not available at this address',
                'errors' => $errors,
            ], 404);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to create subscription',
        ], $response->status());

    } catch (RequestException $e) {
        Log::error('Create subscription request failed', [
            'error' => $e->getMessage(),
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to subscription service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> createSubscription({
      required int packageId,
      required int quantity,
      required List<Map<String, int>> selectedOptions,
      required String frequency,
      required String deliveryDay,
      required String deliveryTime,
      required int deliveryAddressId,
      required String startDate,
      required String paymentMethod,
    }) async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        final response = await http.post(
          Uri.parse('https://api.currydash.au/api/v1/subscriptions'),
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json',
            'Authorization': 'Bearer $accessToken',
          },
          body: jsonEncode({
            'package_id': packageId,
            'quantity': quantity,
            'selected_options': selectedOptions,
            'frequency': frequency,
            'delivery_day': deliveryDay,
            'delivery_time': deliveryTime,
            'delivery_address_id': deliveryAddressId,
            'start_date': startDate,
            'payment_method': paymentMethod,
          }),
        );

        if (response.statusCode == 201) {
          final data = jsonDecode(response.body);
          return {
            'success': true,
            'message': 'Subscription created successfully',
            'subscription': data,
          };
        }

        // Handle validation errors (422)
        if (response.statusCode == 422) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': 'Validation failed',
            'errors': errors,
          };
        }

        // Handle invalid start date (400)
        if (response.statusCode == 400) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': errors.isNotEmpty ? errors[0]['message'] : 'Invalid subscription data',
            'errors': errors,
          };
        }

        // Handle payment setup failure (402)
        if (response.statusCode == 402) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': 'Payment authorization failed',
            'errors': errors,
          };
        }

        // Handle zone not available (404)
        if (response.statusCode == 404) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': 'Service not available at this address',
            'errors': errors,
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to create subscription',
        };
      } catch (e) {
        return {
          'success': false,
          'message': 'Unable to connect to subscription service',
          'error': e.toString(),
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    curl -X POST https://api.currydash.au/api/v1/subscriptions \
      -H "Content-Type: application/json" \
      -H "Accept: application/json" \
      -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
      -d '{
        "package_id": 1,
        "quantity": 1,
        "selected_options": [
          {"option_id": 1},
          {"option_id": 2},
          {"option_id": 5}
        ],
        "frequency": "weekly",
        "delivery_day": "monday",
        "delivery_time": "18:00",
        "delivery_address_id": 12,
        "start_date": "2025-12-16",
        "payment_method": "stripe"
      }'
    ```
  </Tabs.Tab>
</Tabs>

**Field Descriptions**:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `package_id` | integer | Yes | Package ID to subscribe to |
| `quantity` | integer | Yes | Quantity per delivery (min: 1, max: 5) |
| `selected_options` | array | Yes | Package configuration options (same format as cart/package) |
| `frequency` | string | Yes | Delivery frequency: `weekly`, `biweekly`, or `monthly` |
| `delivery_day` | string | Yes | Day of week: `monday`, `tuesday`, `wednesday`, `thursday`, `friday`, `saturday`, `sunday` |
| `delivery_time` | string | Yes | Preferred delivery time in HH:mm format (24-hour) |
| `delivery_address_id` | integer | Yes | Address ID for deliveries |
| `start_date` | date | Yes | First delivery date (must be after today) |
| `payment_method` | string | Yes | Payment method: `stripe` or `paypal` (cash_on_delivery not supported) |

**Validation Rules**:

```php
[
    'package_id' => 'required|exists:packages,id',
    'quantity' => 'required|integer|min:1|max:5',
    'selected_options' => 'required|array|min:1',
    'selected_options.*.option_id' => 'required|exists:package_options,id',
    'frequency' => 'required|in:weekly,biweekly,monthly',
    'delivery_day' => 'required|in:monday,tuesday,wednesday,thursday,friday,saturday,sunday',
    'delivery_time' => 'required|date_format:H:i',
    'delivery_address_id' => 'required|exists:addresses,id',
    'start_date' => 'required|date|after:today',
    'payment_method' => 'required|in:stripe,paypal',
]
```

**Business Logic**:

<Steps>

### Validate Package Options
Validate package exists, is active, and selected options meet min/max requirements (same as cart/package validation).

### Verify Delivery Address
Ensure delivery address is within the restaurant's service zone.

### Validate Start Date
Verify start date falls on the selected delivery day and is at least 48 hours in advance.

### Setup Payment Method
Create recurring payment authorization with the payment gateway (Stripe/PayPal subscription).

### Calculate Subscription Price
Calculate per-delivery price based on package base price + selected option charges.

### Create Subscription Record
Create subscription with schedule, payment method, and customer preferences.

### Schedule First Delivery
Create the first order record scheduled for the start date.

### Send Confirmation
Trigger email/SMS confirmation with subscription details and next delivery date.

</Steps>

**Success Response** (201 Created):

```json
{
  "subscription_id": 234,
  "status": "active",
  "package": {
    "id": 1,
    "name": "Family Curry Pack",
    "restaurant_name": "Lankan Spice House"
  },
  "frequency": "weekly",
  "delivery_day": "Monday",
  "delivery_time": "18:00",
  "next_delivery_date": "2025-12-16",
  "per_delivery_amount": 50.00,
  "payment_method": "stripe",
  "payment_status": "authorized",
  "message": "Subscription created successfully"
}
```

**Error Response** (400 Bad Request - Invalid Start Date):

```json
{
  "errors": [
    {
      "code": "subscription-001",
      "message": "Start date must be at least 48 hours in advance"
    }
  ]
}
```

**Error Response** (400 Bad Request - Day Mismatch):

```json
{
  "errors": [
    {
      "code": "subscription-002",
      "message": "Start date (2025-12-16) is not a Monday. Please select a Monday or change delivery_day."
    }
  ]
}
```

**Error Response** (402 Payment Required - Payment Setup Failed):

```json
{
  "errors": [
    {
      "code": "payment-002",
      "message": "Unable to authorize recurring payment. Please check your payment method and try again."
    }
  ]
}
```

**Error Response** (404 Not Found - Zone):

```json
{
  "errors": [
    {
      "code": "zone-001",
      "message": "Delivery service is not available at this address"
    }
  ]
}
```

<Callout type="warning">
  Subscriptions require payment method authorization for automatic recurring payments. Cash on delivery is not supported for subscriptions. Start date must be at least 48 hours in advance to allow for processing.
</Callout>

---

### Pause Subscription

Temporarily pause a subscription for a specified period or indefinitely.

#### PUT `/api/v1/subscriptions/{id}/pause`

**Controller**: `App\Http\Controllers\Api\V1\SubscriptionController@pause`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 20 requests/minute per user

**Path Parameters**:

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | integer | Yes | The subscription ID to pause |

**Request Body**:

```json
{
  "pause_until": "2026-01-06"
}
```

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');
        $subscriptionId = 234;

        $response = Http::withToken($accessToken)
            ->put("https://api.currydash.au/api/v1/subscriptions/{$subscriptionId}/pause", [
                'pause_until' => '2026-01-06',
            ]);

        if ($response->successful()) {
            $data = $response->json();

            return response()->json([
                'success' => true,
                'message' => $data['message'] ?? 'Subscription paused successfully',
                'subscription' => $data['subscription'],
            ]);
        }

        // Handle not found (404)
        if ($response->status() === 404) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => 'Subscription not found or does not belong to you',
                'errors' => $errors,
            ], 404);
        }

        // Handle already paused (400)
        if ($response->status() === 400) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => $errors[0]['message'] ?? 'Cannot pause subscription',
                'errors' => $errors,
            ], 400);
        }

        // Handle validation errors (422)
        if ($response->status() === 422) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => 'Validation failed',
                'errors' => $errors,
            ], 422);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to pause subscription',
        ], $response->status());

    } catch (RequestException $e) {
        Log::error('Pause subscription request failed', [
            'subscription_id' => $subscriptionId ?? null,
            'error' => $e->getMessage(),
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to subscription service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> pauseSubscription({
      required int subscriptionId,
      String? pauseUntil,
    }) async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        final response = await http.put(
          Uri.parse('https://api.currydash.au/api/v1/subscriptions/$subscriptionId/pause'),
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json',
            'Authorization': 'Bearer $accessToken',
          },
          body: jsonEncode({
            if (pauseUntil != null) 'pause_until': pauseUntil,
          }),
        );

        if (response.statusCode == 200) {
          final data = jsonDecode(response.body);
          return {
            'success': true,
            'message': data['message'] ?? 'Subscription paused successfully',
            'subscription': data['subscription'],
          };
        }

        // Handle not found (404)
        if (response.statusCode == 404) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': 'Subscription not found or does not belong to you',
            'errors': errors,
          };
        }

        // Handle already paused (400)
        if (response.statusCode == 400) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': errors.isNotEmpty ? errors[0]['message'] : 'Cannot pause subscription',
            'errors': errors,
          };
        }

        // Handle validation errors (422)
        if (response.statusCode == 422) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': 'Validation failed',
            'errors': errors,
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to pause subscription',
        };
      } catch (e) {
        return {
          'success': false,
          'message': 'Unable to connect to subscription service',
          'error': e.toString(),
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    curl -X PUT https://api.currydash.au/api/v1/subscriptions/234/pause \
      -H "Content-Type: application/json" \
      -H "Accept: application/json" \
      -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
      -d '{
        "pause_until": "2026-01-06"
      }'
    ```
  </Tabs.Tab>
</Tabs>

**Field Descriptions**:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `pause_until` | date | No | Date to resume subscription (ISO 8601). If null, pauses indefinitely |

**Validation Rules**:

```php
[
    'pause_until' => 'nullable|date|after:today',
]
```

**Business Logic**:

<Steps>

### Verify Ownership
Ensure subscription belongs to authenticated user.

### Check Current Status
Verify subscription is currently active (cannot pause already paused/canceled subscriptions).

### Cancel Pending Orders
Cancel any scheduled orders between now and pause_until date.

### Update Subscription Status
Set status to `paused` and record pause_until date.

### Calculate Next Delivery
If pause_until is specified, calculate next delivery date after resumption based on frequency.

### Send Confirmation
Notify customer via email/SMS about paused subscription.

</Steps>

**Success Response** (200 OK):

```json
{
  "message": "Subscription paused successfully",
  "subscription": {
    "id": 234,
    "status": "paused",
    "pause_until": "2026-01-06",
    "next_delivery_date": "2026-01-13",
    "paused_at": "2025-12-10T10:30:00Z"
  }
}
```

**Success Response** (200 OK - Indefinite Pause):

```json
{
  "message": "Subscription paused successfully",
  "subscription": {
    "id": 234,
    "status": "paused",
    "pause_until": null,
    "next_delivery_date": null,
    "paused_at": "2025-12-10T10:30:00Z"
  }
}
```

**Error Response** (404 Not Found):

```json
{
  "errors": [
    {
      "code": "subscription-003",
      "message": "Subscription not found or does not belong to you"
    }
  ]
}
```

**Error Response** (400 Bad Request - Already Paused):

```json
{
  "errors": [
    {
      "code": "subscription-004",
      "message": "Subscription is already paused. Use resume endpoint to reactivate."
    }
  ]
}
```

<Callout type="info">
  When pausing a subscription, any orders already in preparation or out for delivery will not be canceled. Only future scheduled orders are affected. To resume, use the resume endpoint or the subscription will automatically resume after the pause_until date.
</Callout>

---

### Resume Subscription

Resume a paused subscription and reschedule deliveries.

#### PUT `/api/v1/subscriptions/{id}/resume`

**Controller**: `App\Http\Controllers\Api\V1\SubscriptionController@resume`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 20 requests/minute per user

**Path Parameters**:

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | integer | Yes | The subscription ID to resume |

**Request Body**:

```json
{
  "resume_immediately": true
}
```

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');
        $subscriptionId = 234;

        $response = Http::withToken($accessToken)
            ->put("https://api.currydash.au/api/v1/subscriptions/{$subscriptionId}/resume", [
                'resume_immediately' => true,
            ]);

        if ($response->successful()) {
            $data = $response->json();

            return response()->json([
                'success' => true,
                'message' => $data['message'] ?? 'Subscription resumed successfully',
                'subscription' => $data['subscription'],
            ]);
        }

        // Handle not found (404)
        if ($response->status() === 404) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => 'Subscription not found or does not belong to you',
                'errors' => $errors,
            ], 404);
        }

        // Handle not paused (400)
        if ($response->status() === 400) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => $errors[0]['message'] ?? 'Subscription is not paused',
                'errors' => $errors,
            ], 400);
        }

        // Handle payment method invalid (402)
        if ($response->status() === 402) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => 'Payment method is no longer valid. Please update payment method.',
                'errors' => $errors,
            ], 402);
        }

        // Handle validation errors (422)
        if ($response->status() === 422) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => 'Validation failed',
                'errors' => $errors,
            ], 422);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to resume subscription',
        ], $response->status());

    } catch (RequestException $e) {
        Log::error('Resume subscription request failed', [
            'subscription_id' => $subscriptionId ?? null,
            'error' => $e->getMessage(),
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to subscription service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> resumeSubscription({
      required int subscriptionId,
      bool? resumeImmediately,
    }) async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        final response = await http.put(
          Uri.parse('https://api.currydash.au/api/v1/subscriptions/$subscriptionId/resume'),
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json',
            'Authorization': 'Bearer $accessToken',
          },
          body: jsonEncode({
            if (resumeImmediately != null) 'resume_immediately': resumeImmediately,
          }),
        );

        if (response.statusCode == 200) {
          final data = jsonDecode(response.body);
          return {
            'success': true,
            'message': data['message'] ?? 'Subscription resumed successfully',
            'subscription': data['subscription'],
          };
        }

        // Handle not found (404)
        if (response.statusCode == 404) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': 'Subscription not found or does not belong to you',
            'errors': errors,
          };
        }

        // Handle not paused (400)
        if (response.statusCode == 400) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': errors.isNotEmpty ? errors[0]['message'] : 'Subscription is not paused',
            'errors': errors,
          };
        }

        // Handle payment method invalid (402)
        if (response.statusCode == 402) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': 'Payment method is no longer valid. Please update payment method.',
            'errors': errors,
          };
        }

        // Handle validation errors (422)
        if (response.statusCode == 422) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': 'Validation failed',
            'errors': errors,
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to resume subscription',
        };
      } catch (e) {
        return {
          'success': false,
          'message': 'Unable to connect to subscription service',
          'error': e.toString(),
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    curl -X PUT https://api.currydash.au/api/v1/subscriptions/234/resume \
      -H "Content-Type: application/json" \
      -H "Accept: application/json" \
      -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
      -d '{
        "resume_immediately": true
      }'
    ```
  </Tabs.Tab>
</Tabs>

**Field Descriptions**:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `resume_immediately` | boolean | No | If true, resume immediately. If false or not provided, resume on original schedule |

**Validation Rules**:

```php
[
    'resume_immediately' => 'nullable|boolean',
]
```

**Business Logic**:

<Steps>

### Verify Ownership
Ensure subscription belongs to authenticated user.

### Check Current Status
Verify subscription is currently paused.

### Validate Payment Method
Check if payment method is still valid and authorized.

### Calculate Next Delivery
If resuming immediately, calculate next delivery based on selected delivery day. Otherwise, use original schedule.

### Update Subscription Status
Set status to `active` and clear pause_until date.

### Schedule Next Order
Create order record for the next scheduled delivery.

### Send Confirmation
Notify customer via email/SMS about resumed subscription with next delivery date.

</Steps>

**Success Response** (200 OK):

```json
{
  "message": "Subscription resumed successfully",
  "subscription": {
    "id": 234,
    "status": "active",
    "next_delivery_date": "2025-12-16",
    "resumed_at": "2025-12-10T10:30:00Z"
  }
}
```

**Error Response** (404 Not Found):

```json
{
  "errors": [
    {
      "code": "subscription-003",
      "message": "Subscription not found or does not belong to you"
    }
  ]
}
```

**Error Response** (400 Bad Request - Not Paused):

```json
{
  "errors": [
    {
      "code": "subscription-005",
      "message": "Subscription is not paused. Current status: active"
    }
  ]
}
```

**Error Response** (402 Payment Required):

```json
{
  "errors": [
    {
      "code": "payment-003",
      "message": "Payment method is no longer valid. Please update payment method before resuming subscription."
    }
  ]
}
```

<Callout type="tip">
  If your payment method has expired during the pause period, you'll need to update it before resuming. Use the update subscription endpoint to add a new payment method.
</Callout>

---

### Cancel Subscription

Permanently cancel a subscription. This action cannot be undone.

#### DELETE `/api/v1/subscriptions/{id}`

**Controller**: `App\Http\Controllers\Api\V1\SubscriptionController@cancel`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 10 requests/minute per user

**Path Parameters**:

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | integer | Yes | The subscription ID to cancel |

**Request Body**:

```json
{
  "cancellation_reason": "No longer needed",
  "feedback": "Great service, but dietary requirements changed"
}
```

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');
        $subscriptionId = 234;

        $response = Http::withToken($accessToken)
            ->delete("https://api.currydash.au/api/v1/subscriptions/{$subscriptionId}", [
                'cancellation_reason' => 'No longer needed',
                'feedback' => 'Great service, but dietary requirements changed',
            ]);

        if ($response->successful()) {
            $data = $response->json();

            return response()->json([
                'success' => true,
                'message' => $data['message'] ?? 'Subscription canceled successfully',
                'subscription' => $data['subscription'],
                'pending_orders' => $data['pending_orders'] ?? null,
            ]);
        }

        // Handle not found (404)
        if ($response->status() === 404) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => 'Subscription not found or does not belong to you',
                'errors' => $errors,
            ], 404);
        }

        // Handle already canceled (400)
        if ($response->status() === 400) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => $errors[0]['message'] ?? 'Subscription is already canceled',
                'errors' => $errors,
            ], 400);
        }

        // Handle validation errors (422)
        if ($response->status() === 422) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => 'Validation failed',
                'errors' => $errors,
            ], 422);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to cancel subscription',
        ], $response->status());

    } catch (RequestException $e) {
        Log::error('Cancel subscription request failed', [
            'subscription_id' => $subscriptionId ?? null,
            'error' => $e->getMessage(),
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to subscription service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> cancelSubscription({
      required int subscriptionId,
      String? cancellationReason,
      String? feedback,
    }) async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        final request = http.Request(
          'DELETE',
          Uri.parse('https://api.currydash.au/api/v1/subscriptions/$subscriptionId'),
        );

        request.headers.addAll({
          'Content-Type': 'application/json',
          'Accept': 'application/json',
          'Authorization': 'Bearer $accessToken',
        });

        request.body = jsonEncode({
          if (cancellationReason != null) 'cancellation_reason': cancellationReason,
          if (feedback != null) 'feedback': feedback,
        });

        final streamedResponse = await request.send();
        final response = await http.Response.fromStream(streamedResponse);

        if (response.statusCode == 200) {
          final data = jsonDecode(response.body);
          return {
            'success': true,
            'message': data['message'] ?? 'Subscription canceled successfully',
            'subscription': data['subscription'],
            'pending_orders': data['pending_orders'],
          };
        }

        // Handle not found (404)
        if (response.statusCode == 404) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': 'Subscription not found or does not belong to you',
            'errors': errors,
          };
        }

        // Handle already canceled (400)
        if (response.statusCode == 400) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': errors.isNotEmpty ? errors[0]['message'] : 'Subscription is already canceled',
            'errors': errors,
          };
        }

        // Handle validation errors (422)
        if (response.statusCode == 422) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': 'Validation failed',
            'errors': errors,
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to cancel subscription',
        };
      } catch (e) {
        return {
          'success': false,
          'message': 'Unable to connect to subscription service',
          'error': e.toString(),
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    curl -X DELETE https://api.currydash.au/api/v1/subscriptions/234 \
      -H "Content-Type: application/json" \
      -H "Accept: application/json" \
      -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
      -d '{
        "cancellation_reason": "No longer needed",
        "feedback": "Great service, but dietary requirements changed"
      }'
    ```
  </Tabs.Tab>
</Tabs>

**Field Descriptions**:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `cancellation_reason` | string | No | Reason for cancellation (for analytics) |
| `feedback` | string | No | Optional feedback (max 500 characters) |

**Validation Rules**:

```php
[
    'cancellation_reason' => 'nullable|string|max:200',
    'feedback' => 'nullable|string|max:500',
]
```

**Business Logic**:

<Steps>

### Verify Ownership
Ensure subscription belongs to authenticated user.

### Check Pending Orders
Identify any orders in preparation or out for delivery.

### Cancel Future Orders
Cancel all scheduled orders that haven't started preparation.

### Terminate Payment Authorization
Cancel recurring payment authorization with payment gateway.

### Update Subscription Status
Set status to `canceled` and record cancellation date and reason.

### Calculate Savings/Usage Stats
Generate summary of subscription usage for confirmation message.

### Send Confirmation
Notify customer with cancellation confirmation and any relevant refund information.

</Steps>

**Success Response** (200 OK):

```json
{
  "message": "Subscription canceled successfully",
  "subscription": {
    "id": 234,
    "status": "canceled",
    "canceled_at": "2025-12-10T10:30:00Z",
    "total_deliveries": 12,
    "total_amount_paid": 600.00
  },
  "pending_orders": {
    "count": 1,
    "status": "Will be delivered as scheduled",
    "order_ids": [789]
  }
}
```

**Error Response** (404 Not Found):

```json
{
  "errors": [
    {
      "code": "subscription-003",
      "message": "Subscription not found or does not belong to you"
    }
  ]
}
```

**Error Response** (400 Bad Request - Already Canceled):

```json
{
  "errors": [
    {
      "code": "subscription-006",
      "message": "Subscription is already canceled"
    }
  ]
}
```

<Callout type="warning">
  Canceling a subscription is permanent and cannot be undone. You'll need to create a new subscription if you wish to resume deliveries. Orders already in preparation or out for delivery will still be completed.
</Callout>

---

### Update Subscription

Update subscription details including delivery preferences, package selection, or payment method.

#### PUT `/api/v1/subscriptions/{id}`

**Controller**: `App\Http\Controllers\Api\V1\SubscriptionController@update`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 20 requests/minute per user

**Path Parameters**:

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | integer | Yes | The subscription ID to update |

**Request Body**:

```json
{
  "quantity": 2,
  "selected_options": [
    {"option_id": 1},
    {"option_id": 3},
    {"option_id": 5}
  ],
  "frequency": "biweekly",
  "delivery_day": "wednesday",
  "delivery_time": "19:00",
  "delivery_address_id": 15,
  "payment_method": "paypal"
}
```

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');
        $subscriptionId = 234;

        $response = Http::withToken($accessToken)
            ->put("https://api.currydash.au/api/v1/subscriptions/{$subscriptionId}", [
                'quantity' => 2,
                'selected_options' => [
                    ['option_id' => 1],
                    ['option_id' => 3],
                    ['option_id' => 5],
                ],
                'frequency' => 'biweekly',
                'delivery_day' => 'wednesday',
                'delivery_time' => '19:00',
                'delivery_address_id' => 15,
                'payment_method' => 'paypal',
            ]);

        if ($response->successful()) {
            $data = $response->json();

            return response()->json([
                'success' => true,
                'message' => $data['message'] ?? 'Subscription updated successfully',
                'subscription' => $data['subscription'],
            ]);
        }

        // Handle not found (404)
        if ($response->status() === 404) {
            $errors = $response->json('errors', []);
            $message = $errors[0]['message'] ?? 'Subscription not found or does not belong to you';

            // Check if it's a zone error
            if (isset($errors[0]['code']) && $errors[0]['code'] === 'zone-001') {
                $message = 'Delivery service is not available at the new address';
            }

            return response()->json([
                'success' => false,
                'message' => $message,
                'errors' => $errors,
            ], 404);
        }

        // Handle cannot update canceled (400)
        if ($response->status() === 400) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => $errors[0]['message'] ?? 'Cannot update subscription',
                'errors' => $errors,
            ], 400);
        }

        // Handle validation errors (422)
        if ($response->status() === 422) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => 'Validation failed',
                'errors' => $errors,
            ], 422);
        }

        // Handle payment authorization failure (402)
        if ($response->status() === 402) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => 'Payment authorization failed for new payment method',
                'errors' => $errors,
            ], 402);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to update subscription',
        ], $response->status());

    } catch (RequestException $e) {
        Log::error('Update subscription request failed', [
            'subscription_id' => $subscriptionId ?? null,
            'error' => $e->getMessage(),
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to subscription service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> updateSubscription({
      required int subscriptionId,
      int? quantity,
      List<Map<String, int>>? selectedOptions,
      String? frequency,
      String? deliveryDay,
      String? deliveryTime,
      int? deliveryAddressId,
      String? paymentMethod,
    }) async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        final body = <String, dynamic>{};
        if (quantity != null) body['quantity'] = quantity;
        if (selectedOptions != null) body['selected_options'] = selectedOptions;
        if (frequency != null) body['frequency'] = frequency;
        if (deliveryDay != null) body['delivery_day'] = deliveryDay;
        if (deliveryTime != null) body['delivery_time'] = deliveryTime;
        if (deliveryAddressId != null) body['delivery_address_id'] = deliveryAddressId;
        if (paymentMethod != null) body['payment_method'] = paymentMethod;

        final response = await http.put(
          Uri.parse('https://api.currydash.au/api/v1/subscriptions/$subscriptionId'),
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json',
            'Authorization': 'Bearer $accessToken',
          },
          body: jsonEncode(body),
        );

        if (response.statusCode == 200) {
          final data = jsonDecode(response.body);
          return {
            'success': true,
            'message': data['message'] ?? 'Subscription updated successfully',
            'subscription': data['subscription'],
          };
        }

        // Handle not found (404)
        if (response.statusCode == 404) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          String message = errors.isNotEmpty ? errors[0]['message'] : 'Subscription not found or does not belong to you';

          // Check if it's a zone error
          if (errors.isNotEmpty && errors[0]['code'] == 'zone-001') {
            message = 'Delivery service is not available at the new address';
          }

          return {
            'success': false,
            'message': message,
            'errors': errors,
          };
        }

        // Handle cannot update canceled (400)
        if (response.statusCode == 400) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': errors.isNotEmpty ? errors[0]['message'] : 'Cannot update subscription',
            'errors': errors,
          };
        }

        // Handle validation errors (422)
        if (response.statusCode == 422) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': 'Validation failed',
            'errors': errors,
          };
        }

        // Handle payment authorization failure (402)
        if (response.statusCode == 402) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': 'Payment authorization failed for new payment method',
            'errors': errors,
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to update subscription',
        };
      } catch (e) {
        return {
          'success': false,
          'message': 'Unable to connect to subscription service',
          'error': e.toString(),
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    curl -X PUT https://api.currydash.au/api/v1/subscriptions/234 \
      -H "Content-Type: application/json" \
      -H "Accept: application/json" \
      -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
      -d '{
        "quantity": 2,
        "selected_options": [
          {"option_id": 1},
          {"option_id": 3},
          {"option_id": 5}
        ],
        "frequency": "biweekly",
        "delivery_day": "wednesday",
        "delivery_time": "19:00",
        "delivery_address_id": 15,
        "payment_method": "paypal"
      }'
    ```
  </Tabs.Tab>
</Tabs>

**Field Descriptions**:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `quantity` | integer | No | Quantity per delivery (min: 1, max: 5) |
| `selected_options` | array | No | Updated package configuration options |
| `frequency` | string | No | New delivery frequency |
| `delivery_day` | string | No | New day of week for deliveries |
| `delivery_time` | string | No | New preferred delivery time (HH:mm format) |
| `delivery_address_id` | integer | No | New delivery address ID |
| `payment_method` | string | No | New payment method: `stripe` or `paypal` |

**Validation Rules**:

```php
[
    'quantity' => 'nullable|integer|min:1|max:5',
    'selected_options' => 'nullable|array|min:1',
    'selected_options.*.option_id' => 'required|exists:package_options,id',
    'frequency' => 'nullable|in:weekly,biweekly,monthly',
    'delivery_day' => 'nullable|in:monday,tuesday,wednesday,thursday,friday,saturday,sunday',
    'delivery_time' => 'nullable|date_format:H:i',
    'delivery_address_id' => 'nullable|exists:addresses,id',
    'payment_method' => 'nullable|in:stripe,paypal',
]
```

**Business Logic**:

<Steps>

### Verify Ownership
Ensure subscription belongs to authenticated user.

### Check Current Status
Verify subscription is active or paused (cannot update canceled subscriptions).

### Validate Package Options
If updating selected_options, validate they meet package configuration requirements.

### Verify New Address
If updating delivery_address_id, ensure it's within the restaurant's service zone.

### Update Payment Method
If changing payment method, authorize new payment method and cancel old authorization.

### Recalculate Price
Calculate new per-delivery price based on updated options and quantity.

### Reschedule Future Deliveries
If frequency or delivery_day changed, recalculate all future delivery dates.

### Update Subscription Record
Save all changes to subscription.

### Send Confirmation
Notify customer with updated subscription details and next delivery date.

</Steps>

**Success Response** (200 OK):

```json
{
  "message": "Subscription updated successfully",
  "subscription": {
    "id": 234,
    "status": "active",
    "package": {
      "id": 1,
      "name": "Family Curry Pack"
    },
    "quantity": 2,
    "frequency": "biweekly",
    "delivery_day": "Wednesday",
    "delivery_time": "19:00",
    "next_delivery_date": "2025-12-18",
    "per_delivery_amount": 105.00,
    "payment_method": "paypal",
    "updated_at": "2025-12-10T10:30:00Z"
  }
}
```

**Error Response** (404 Not Found):

```json
{
  "errors": [
    {
      "code": "subscription-003",
      "message": "Subscription not found or does not belong to you"
    }
  ]
}
```

**Error Response** (400 Bad Request - Cannot Update Canceled):

```json
{
  "errors": [
    {
      "code": "subscription-007",
      "message": "Cannot update canceled subscription. Please create a new subscription."
    }
  ]
}
```

**Error Response** (404 Not Found - Zone):

```json
{
  "errors": [
    {
      "code": "zone-001",
      "message": "Delivery service is not available at the new address"
    }
  ]
}
```

**Error Response** (422 Unprocessable Entity - Package Options):

```json
{
  "errors": [
    {
      "code": "package-001",
      "message": "Please select at least 2 options for 'Choose your protein (Select 2-3)'"
    }
  ]
}
```

<Callout type="info">
  Changes to subscription frequency or delivery day will affect all future deliveries. Any orders already scheduled for the next delivery will be updated to reflect the changes. Price changes will apply starting from the next delivery.
</Callout>

---

### Get Subscription Details

Retrieve complete details for a specific subscription including delivery history and upcoming orders.

#### GET `/api/v1/subscriptions/{id}`

**Controller**: `App\Http\Controllers\Api\V1\SubscriptionController@show`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 60 requests/minute per user

**Path Parameters**:

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | integer | Yes | The subscription ID to retrieve |

**Example Request**:

```
GET /api/v1/subscriptions/234
```

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');
        $subscriptionId = 234;

        $response = Http::withToken($accessToken)
            ->get("https://api.currydash.au/api/v1/subscriptions/{$subscriptionId}");

        if ($response->successful()) {
            $data = $response->json();

            return response()->json([
                'success' => true,
                'subscription' => $data,
            ]);
        }

        // Handle not found (404)
        if ($response->status() === 404) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => 'Subscription not found or does not belong to you',
                'errors' => $errors,
            ], 404);
        }

        // Handle unauthorized (401)
        if ($response->status() === 401) {
            return response()->json([
                'success' => false,
                'message' => 'Authentication required',
            ], 401);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to retrieve subscription',
        ], $response->status());

    } catch (RequestException $e) {
        Log::error('Get subscription request failed', [
            'subscription_id' => $subscriptionId ?? null,
            'error' => $e->getMessage(),
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to subscription service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> getSubscriptionDetails({
      required int subscriptionId,
    }) async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        final response = await http.get(
          Uri.parse('https://api.currydash.au/api/v1/subscriptions/$subscriptionId'),
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json',
            'Authorization': 'Bearer $accessToken',
          },
        );

        if (response.statusCode == 200) {
          final data = jsonDecode(response.body);
          return {
            'success': true,
            'subscription': data,
          };
        }

        // Handle not found (404)
        if (response.statusCode == 404) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': 'Subscription not found or does not belong to you',
            'errors': errors,
          };
        }

        // Handle unauthorized (401)
        if (response.statusCode == 401) {
          return {
            'success': false,
            'message': 'Authentication required',
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to retrieve subscription',
        };
      } catch (e) {
        return {
          'success': false,
          'message': 'Unable to connect to subscription service',
          'error': e.toString(),
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    curl -X GET https://api.currydash.au/api/v1/subscriptions/234 \
      -H "Content-Type: application/json" \
      -H "Accept: application/json" \
      -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
    ```
  </Tabs.Tab>
</Tabs>

**Success Response** (200 OK):

```json
{
  "id": 234,
  "status": "active",
  "package": {
    "id": 1,
    "name": "Family Curry Pack",
    "description": "Perfect for 4 people",
    "image": "https://currydash.au/storage/packages/pack_1.jpg",
    "restaurant": {
      "id": 15,
      "name": "Lankan Spice House",
      "logo": "https://currydash.au/storage/restaurant/logo_15.jpg"
    }
  },
  "quantity": 1,
  "selected_options": [
    {
      "option_id": 1,
      "food_name": "Chicken Curry",
      "additional_charge": 0.00
    },
    {
      "option_id": 2,
      "food_name": "Lamb Curry",
      "additional_charge": 5.00
    },
    {
      "option_id": 5,
      "food_name": "Medium",
      "additional_charge": 0.00
    }
  ],
  "frequency": "weekly",
  "delivery_day": "Monday",
  "delivery_time": "18:00",
  "delivery_address": {
    "id": 12,
    "address_type": "home",
    "contact_person_name": "John Doe",
    "contact_person_number": "+61423456789",
    "address": "45 Bridge Rd, Richmond VIC 3121",
    "house": "Unit 5",
    "floor": "2nd Floor"
  },
  "payment_method": "stripe",
  "payment_status": "authorized",
  "per_delivery_amount": 50.00,
  "start_date": "2025-12-16",
  "next_delivery_date": "2025-12-23",
  "last_delivery_date": "2025-12-16",
  "total_deliveries": 1,
  "total_amount_paid": 50.00,
  "pause_until": null,
  "created_at": "2025-12-10T10:30:00Z",
  "updated_at": "2025-12-10T10:30:00Z",
  "delivery_history": [
    {
      "order_id": 789,
      "delivery_date": "2025-12-16",
      "status": "delivered",
      "amount": 50.00,
      "delivered_at": "2025-12-16T18:25:00Z"
    }
  ],
  "upcoming_deliveries": [
    {
      "scheduled_date": "2025-12-23",
      "estimated_time": "18:00",
      "amount": 50.00
    },
    {
      "scheduled_date": "2025-12-30",
      "estimated_time": "18:00",
      "amount": 50.00
    }
  ]
}
```

**Error Response** (404 Not Found):

```json
{
  "errors": [
    {
      "code": "subscription-003",
      "message": "Subscription not found or does not belong to you"
    }
  ]
}
```

---

### List User Subscriptions

Retrieve all subscriptions for the authenticated user with filtering options.

#### GET `/api/v1/subscriptions`

**Controller**: `App\Http\Controllers\Api\V1\SubscriptionController@index`

**Authentication**: Required (`auth:api`)

**Rate Limit**: 60 requests/minute per user

**Query Parameters**:

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `status` | string | No | Filter by status: `active`, `paused`, `canceled`, `expired` |
| `limit` | integer | No | Number of subscriptions per page (default: 10, max: 50) |
| `offset` | integer | No | Pagination offset (default: 0) |

**Example Request**:

```
GET /api/v1/subscriptions?status=active&limit=10&offset=0
```

**Code Examples**:

<Tabs items={['PHP/Laravel', 'Dart/Flutter', 'cURL']}>
  <Tabs.Tab>
    ```php
    use Illuminate\Support\Facades\Http;
    use Illuminate\Http\Client\RequestException;

    try {
        $accessToken = session('access_token');

        $response = Http::withToken($accessToken)
            ->get('https://api.currydash.au/api/v1/subscriptions', [
                'status' => 'active',
                'limit' => 10,
                'offset' => 0,
            ]);

        if ($response->successful()) {
            $data = $response->json();

            return response()->json([
                'success' => true,
                'total_size' => $data['total_size'],
                'limit' => $data['limit'],
                'offset' => $data['offset'],
                'subscriptions' => $data['subscriptions'],
            ]);
        }

        // Handle unauthorized (401)
        if ($response->status() === 401) {
            return response()->json([
                'success' => false,
                'message' => 'Authentication required',
            ], 401);
        }

        // Handle validation errors (422)
        if ($response->status() === 422) {
            $errors = $response->json('errors', []);
            return response()->json([
                'success' => false,
                'message' => 'Invalid query parameters',
                'errors' => $errors,
            ], 422);
        }

        // Handle other errors
        return response()->json([
            'success' => false,
            'message' => 'Failed to retrieve subscriptions',
        ], $response->status());

    } catch (RequestException $e) {
        Log::error('List subscriptions request failed', [
            'error' => $e->getMessage(),
        ]);

        return response()->json([
            'success' => false,
            'message' => 'Unable to connect to subscription service',
        ], 500);
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```dart
    import 'dart:convert';
    import 'package:http/http.dart' as http;
    import 'package:flutter_secure_storage/flutter_secure_storage.dart';

    Future<Map<String, dynamic>> listSubscriptions({
      String? status,
      int limit = 10,
      int offset = 0,
    }) async {
      final storage = FlutterSecureStorage();

      try {
        final accessToken = await storage.read(key: 'access_token');

        final queryParams = {
          if (status != null) 'status': status,
          'limit': limit.toString(),
          'offset': offset.toString(),
        };

        final uri = Uri.parse('https://api.currydash.au/api/v1/subscriptions')
            .replace(queryParameters: queryParams);

        final response = await http.get(
          uri,
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json',
            'Authorization': 'Bearer $accessToken',
          },
        );

        if (response.statusCode == 200) {
          final data = jsonDecode(response.body);
          return {
            'success': true,
            'total_size': data['total_size'],
            'limit': data['limit'],
            'offset': data['offset'],
            'subscriptions': data['subscriptions'],
          };
        }

        // Handle unauthorized (401)
        if (response.statusCode == 401) {
          return {
            'success': false,
            'message': 'Authentication required',
          };
        }

        // Handle validation errors (422)
        if (response.statusCode == 422) {
          final errors = jsonDecode(response.body)['errors'] ?? [];
          return {
            'success': false,
            'message': 'Invalid query parameters',
            'errors': errors,
          };
        }

        // Handle other errors
        return {
          'success': false,
          'message': 'Failed to retrieve subscriptions',
        };
      } catch (e) {
        return {
          'success': false,
          'message': 'Unable to connect to subscription service',
          'error': e.toString(),
        };
      }
    }
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash
    curl -X GET "https://api.currydash.au/api/v1/subscriptions?status=active&limit=10&offset=0" \
      -H "Content-Type: application/json" \
      -H "Accept: application/json" \
      -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
    ```
  </Tabs.Tab>
</Tabs>

**Success Response** (200 OK):

```json
{
  "total_size": 3,
  "limit": 10,
  "offset": 0,
  "subscriptions": [
    {
      "id": 234,
      "status": "active",
      "package": {
        "id": 1,
        "name": "Family Curry Pack",
        "image": "https://currydash.au/storage/packages/pack_1.jpg",
        "restaurant_name": "Lankan Spice House"
      },
      "frequency": "weekly",
      "delivery_day": "Monday",
      "next_delivery_date": "2025-12-23",
      "per_delivery_amount": 50.00,
      "total_deliveries": 1,
      "created_at": "2025-12-10T10:30:00Z"
    },
    {
      "id": 235,
      "status": "active",
      "package": {
        "id": 3,
        "name": "Lunch Combo",
        "image": "https://currydash.au/storage/packages/pack_3.jpg",
        "restaurant_name": "Colombo Kitchen"
      },
      "frequency": "biweekly",
      "delivery_day": "Wednesday",
      "next_delivery_date": "2025-12-18",
      "per_delivery_amount": 15.00,
      "total_deliveries": 5,
      "created_at": "2025-11-15T09:00:00Z"
    }
  ]
}
```

---

## Related Documentation

 **Cross-References**:
- **Package System**: [Packages API](./packages) - Package configuration and customization
- **Cart Management**: [Cart API](./cart) - Add packages before creating subscriptions
- **Order Management**: [Orders API](./orders) - View subscription-generated orders
- **Payment Processing**: [Client API Reference](https://github.com/CoralShades/User-Web-Mobile/blob/main/docs/api-reference.md) - Payment integration
- **Business Logic**: [Business Logic](../../developers/backend/architecture/service-layer-business-logic) - Subscription validation rules

---

## Error Codes Reference

| Error Code | Description | HTTP Status |
|------------|-------------|-------------|
| `subscription-001` | Start date must be at least 48 hours in advance | 400 |
| `subscription-002` | Start date does not match selected delivery day | 400 |
| `subscription-003` | Subscription not found or unauthorized | 404 |
| `subscription-004` | Subscription is already paused | 400 |
| `subscription-005` | Subscription is not paused | 400 |
| `subscription-006` | Subscription is already canceled | 400 |
| `subscription-007` | Cannot update canceled subscription | 400 |
| `payment-002` | Payment authorization failed | 402 |
| `payment-003` | Payment method invalid or expired | 402 |
| `package-001` | Minimum package options not met | 422 |
| `package-002` | Maximum package options exceeded | 422 |
| `zone-001` | Service not available in delivery area | 404 |

---

**Last Updated**: 2026-01-22
**API Version**: v1.0
